{"ast":null,"code":"import _objectSpread from\"/Users/licop/Documents/GitHub/LUI/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/objectSpread2\";import _slicedToArray from\"/Users/licop/Documents/GitHub/LUI/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/slicedToArray\";import _objectWithoutProperties from\"/Users/licop/Documents/GitHub/LUI/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/objectWithoutProperties\";import{jsxs as _jsxs}from\"react/jsx-runtime\";import{jsx as _jsx}from\"react/jsx-runtime\";import React,{useState,useEffect,useRef}from'react';import classNames from'classnames';import Input from'../Input/input';import Icon from'../Icon/icon';import useDebounce from'../../hooks/useDebounce';import useClickOutside from'../../hooks/useClickOutside';import Transition from'../Transition/transition';var AutoComplete=function AutoComplete(props){var fetchSuggestions=props.fetchSuggestions,onSelect=props.onSelect,value=props.value,renderOption=props.renderOption,restProps=_objectWithoutProperties(props,[\"fetchSuggestions\",\"onSelect\",\"value\",\"renderOption\"]);var _useState=useState(false),_useState2=_slicedToArray(_useState,2),isLoading=_useState2[0],setLoading=_useState2[1];var _useState3=useState(value),_useState4=_slicedToArray(_useState3,2),inputValue=_useState4[0],setInputValue=_useState4[1];var _useState5=useState([]),_useState6=_slicedToArray(_useState5,2),suggestions=_useState6[0],setSuggestions=_useState6[1];var _useState7=useState(-1),_useState8=_slicedToArray(_useState7,2),highlightIndex=_useState8[0],setHighlightIndex=_useState8[1];var _useState9=useState(false),_useState10=_slicedToArray(_useState9,2),showDropdown=_useState10[0],setShowDropdown=_useState10[1];var debounceValue=useDebounce(inputValue,500);var triggerSearch=useRef(false);var componentRef=useRef(null);var handleSelect=function handleSelect(item){setInputValue(item.value);setShowDropdown(false);if(onSelect){onSelect(item);}triggerSearch.current=false;};useClickOutside(componentRef,function(){setSuggestions([]);});useEffect(function(){if(debounceValue&&triggerSearch.current){var results=fetchSuggestions(debounceValue);if(results instanceof Promise){setLoading(true);results.then(function(data){setLoading(false);setSuggestions(data);if(data.length>0){setShowDropdown(true);}});}else{setSuggestions(results);if(results.length>0){setShowDropdown(true);}}}else{setShowDropdown(false);}setHighlightIndex(-1);},[debounceValue]);var handleChange=function handleChange(e){var value=e.target.value.trim();setInputValue(value);triggerSearch.current=true;};var highlight=function highlight(index){if(index<0)index=0;if(index>=suggestions.length){index=suggestions.length-1;}setHighlightIndex(index);};var handleKeyDown=function handleKeyDown(e){switch(e.keyCode){case 13:if(suggestions[highlightIndex]){handleSelect(suggestions[highlightIndex]);}break;case 38:highlight(highlightIndex-1);break;case 40:highlight(highlightIndex+1);break;case 27:setShowDropdown(false);break;default:break;}};var generateDropdown=function generateDropdown(){return/*#__PURE__*/_jsx(Transition,{in:showDropdown||isLoading,animation:\"zoom-in-top\",timeout:300,onExited:function onExited(){setSuggestions([]);},children:/*#__PURE__*/_jsxs(\"ul\",{className:\"lui-suggestion-list\",children:[isLoading&&/*#__PURE__*/_jsx(\"div\",{className:\"suggstions-loading-icon\",children:/*#__PURE__*/_jsx(Icon,{icon:\"spinner\",spin:true})}),suggestions.map(function(item,index){var cnames=classNames('suggestion-item',{'is-active':index===highlightIndex});return/*#__PURE__*/_jsx(\"li\",{className:cnames,onClick:function onClick(){return handleSelect(item);},children:renderTemplate(item)},index);})]})});};var renderTemplate=function renderTemplate(item){return renderOption?renderOption(item):item.value;};return/*#__PURE__*/_jsxs(\"div\",{className:\"lui-auto-complete\",ref:componentRef,children:[/*#__PURE__*/_jsx(Input,_objectSpread({value:inputValue,onChange:handleChange,onKeyDown:handleKeyDown},restProps)),generateDropdown()]});};export default AutoComplete;","map":{"version":3,"sources":["/Users/licop/Documents/GitHub/LUI/src/components/AutoComplete/autoComplete.tsx"],"names":["React","useState","useEffect","useRef","classNames","Input","Icon","useDebounce","useClickOutside","Transition","AutoComplete","props","fetchSuggestions","onSelect","value","renderOption","restProps","isLoading","setLoading","inputValue","setInputValue","suggestions","setSuggestions","highlightIndex","setHighlightIndex","showDropdown","setShowDropdown","debounceValue","triggerSearch","componentRef","handleSelect","item","current","results","Promise","then","data","length","handleChange","e","target","trim","highlight","index","handleKeyDown","keyCode","generateDropdown","map","cnames","renderTemplate"],"mappings":"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","sourcesContent":["import React, { FC, useState, ChangeEvent, KeyboardEvent, ReactElement, useEffect, useRef } from 'react';\nimport classNames from 'classnames';\nimport Input, { InputProps } from '../Input/input';\nimport Icon from '../Icon/icon';\nimport useDebounce from '../../hooks/useDebounce'\nimport useClickOutside from '../../hooks/useClickOutside';\nimport Transition from '../Transition/transition';\n\ninterface DataSourceObject {\n    value: string\n}\nexport type DataSourceType<T = {}> = T & DataSourceObject;\n\nexport interface AutoCompleteProps extends Omit<InputProps, 'onSelect'> {\n    fetchSuggestions: (str: string) => DataSourceType[] | Promise<DataSourceType[]>,\n    onSelect?: (str: DataSourceType) => void,\n    renderOption?: (str: DataSourceType) => ReactElement | string\n}\n\nconst AutoComplete: FC<AutoCompleteProps> = (props) => {\n    const {\n        fetchSuggestions,\n        onSelect,\n        value,\n        renderOption,\n        ...restProps\n    } = props;\n    const [isLoading, setLoading] = useState(false)\n    const [inputValue,  setInputValue] = useState(value as string);\n    const [suggestions, setSuggestions] = useState<DataSourceType[]>([]);\n    const [highlightIndex, setHighlightIndex] = useState(-1)\n    const [ showDropdown, setShowDropdown] = useState(false)\n    const debounceValue = useDebounce(inputValue, 500);\n    const triggerSearch = useRef(false);\n    const componentRef = useRef<HTMLDivElement>(null);\n\n    const handleSelect = (item: DataSourceType) => {\n        setInputValue(item.value)\n        setShowDropdown(false)\n        if (onSelect) {\n          onSelect(item)\n        }\n        triggerSearch.current = false;\n    }\n    useClickOutside(componentRef, () => {setSuggestions([])});\n    useEffect(() => {\n        if(debounceValue && triggerSearch.current) {\n            const results = fetchSuggestions(debounceValue);\n            if(results instanceof Promise) {\n                setLoading(true);\n                results.then(data => {\n                    setLoading(false);\n                    setSuggestions(data);\n\n                    if (data.length > 0) {\n                        setShowDropdown(true)\n                    }\n                })\n            } else {\n                setSuggestions(results);\n                if (results.length > 0) {\n                    setShowDropdown(true)\n                }\n            }\n        } else {\n            setShowDropdown(false)\n        }\n        setHighlightIndex(-1);\n    }, [debounceValue])\n\n    const handleChange = (e: ChangeEvent<HTMLInputElement>) => {\n        const value = e.target.value.trim();\n        setInputValue(value);\n        triggerSearch.current = true;\n    }\n    \n    const highlight = (index: number) => {\n        if(index < 0) index = 0;\n        if(index >= suggestions.length) {\n            index = suggestions.length - 1;\n        }\n        setHighlightIndex(index);\n    }\n\n    const handleKeyDown = (e: KeyboardEvent<HTMLInputElement>) => {\n        switch(e.keyCode) {\n            case 13: \n                if(suggestions[highlightIndex]) {\n                    handleSelect(suggestions[highlightIndex])\n                }\n                break;\n            case 38:\n                highlight(highlightIndex - 1)\n                break;\n            case 40: \n                highlight(highlightIndex + 1)\n                break;\n            case 27:\n                setShowDropdown(false)\n                break;\n            default:\n                break;\n\n        }\n    }\n\n    const generateDropdown = () => {\n        return (\n            <Transition\n                in={showDropdown || isLoading}\n                animation=\"zoom-in-top\"\n                timeout={300}\n                onExited={() => {setSuggestions([])}}\n            >\n                <ul className=\"lui-suggestion-list\">\n                    { isLoading &&\n                        <div className=\"suggstions-loading-icon\">\n                            <Icon icon=\"spinner\" spin/>\n                        </div>\n                    }\n                    {suggestions.map((item, index) => {\n                        const cnames = classNames('suggestion-item', {\n                            'is-active': index === highlightIndex\n                        })\n                        return <li key={index} className={cnames} onClick={() => handleSelect(item)}>\n                            {renderTemplate(item)}\n                        </li>\n                    })}\n                </ul>\n            </Transition> \n        )\n    }\n\n    const renderTemplate = (item: any) => {\n        return renderOption ? renderOption(item) : item.value;\n    }\n\n    return (\n        <div className=\"lui-auto-complete\" ref={componentRef}>\n            <Input \n                value={inputValue}\n                onChange={handleChange}\n                onKeyDown={handleKeyDown}\n                {...restProps}\n            />\n            \n            {generateDropdown()}\n        </div>\n    )\n}\n\nexport default AutoComplete;\n"]},"metadata":{},"sourceType":"module"}